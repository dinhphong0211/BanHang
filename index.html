<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh Qu·∫£n l√Ω ƒê∆°n H√†ng</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; text-align: center; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-4 md:p-8 rounded-xl shadow-lg w-full max-w-lg mb-20"> <!-- Th√™m margin-bottom ƒë·ªÉ tr√°nh b·ªã che tr√™n mobile -->
        
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">
                üìù B√°o C√°o
            </h1>
            <!-- M·ªöI: N√∫t X√≥a d·ªØ li·ªáu -->
            <button id="reset-btn" class="text-sm text-red-500 hover:text-red-700 underline font-medium">
                L√†m m·ªõi
            </button>
        </div>

        <div class="mb-6">
            <div class="flex justify-between text-sm font-semibold text-gray-500 mb-2 px-2">
                <span>M·∫∑t h√†ng</span>
                <div class="flex gap-8 mr-2">
                    <span>Nh·∫≠n</span>
                    <span>Tr·∫£</span>
                </div>
            </div>
            <div id="item-list" class="space-y-3">
                <!-- JS ch√®n c√°c m·ª•c v√†o ƒë√¢y -->
            </div>
        </div>

        <div class="flex gap-3 my-6">
            <button id="calculate-btn" class="flex-1 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 text-lg">
                T√≠nh To√°n
            </button>
        </div>

        <hr class="my-6 border-gray-200">

        <div>
            <h2 class="text-xl font-semibold text-gray-700 mb-4">
                üì¶ K·∫øt Qu·∫£ ƒê√£ B√°n
            </h2>
            <div id="result-container">
                <ul id="order-summary" class="space-y-2">
                    <li class="text-gray-500 italic text-center text-sm">Nh·∫≠p s·ªë li·ªáu v√† nh·∫•n T√≠nh to√°n.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const items = ['V·ªè b√°nh', 'B√≤', 'T√¥m', 'G√†', 'X√∫c x√≠ch', 'Tr·ª©ng', 'Ph√¥ mai'];
            
            const recipes = [
                { name: 'Burger B√≤ Tr·ª©ng', ingredients: { 'V·ªè b√°nh': 1, 'B√≤': 1, 'Tr·ª©ng': 1 }, color: 'text-green-700', bgColor: 'bg-green-100' },
                { name: 'Burger T√¥m', ingredients: { 'V·ªè b√°nh': 1, 'T√¥m': 1 }, color: 'text-purple-700', bgColor: 'bg-purple-100' },
                { name: 'Burger G√†', ingredients: { 'V·ªè b√°nh': 1, 'G√†': 1 }, color: 'text-orange-700', bgColor: 'bg-orange-100' },
                { name: 'Burger Tr·ª©ng', ingredients: { 'V·ªè b√°nh': 1, 'Tr·ª©ng': 1 }, color: 'text-yellow-700', bgColor: 'bg-yellow-100' },
                { name: 'Burger X√∫c X√≠ch', ingredients: { 'V·ªè b√°nh': 1, 'X√∫c x√≠ch': 1 }, color: 'text-red-700', bgColor: 'bg-red-100' }
            ];

            const itemList = document.getElementById('item-list');
            const summaryList = document.getElementById('order-summary');
            const calculateBtn = document.getElementById('calculate-btn');
            const resetBtn = document.getElementById('reset-btn');

            // 1. T·∫°o giao di·ªán nh·∫≠p li·ªáu
            items.forEach(item => {
                const itemRow = document.createElement('div');
                itemRow.className = 'flex justify-between items-center bg-gray-50 p-2 rounded-lg border border-gray-100';
                
                const itemName = document.createElement('label');
                itemName.textContent = item;
                itemName.className = 'text-base text-gray-800 font-medium';
                
                const inputWrapper = document.createElement('div');
                inputWrapper.className = 'flex items-center gap-2';

                const id = item.replace(/\s+/g, '-');

                const createInput = (type, placeholder) => {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.id = `item-${type}-${id}`; // v√≠ d·ª•: item-nhan-Vo-banh
                    input.className = `quantity-input w-16 h-10 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-center font-semibold text-lg ${type === 'tra' ? 'text-red-600 bg-red-50' : 'text-blue-600 bg-white'}`;
                    input.placeholder = placeholder;
                    // M·ªöI: Th√™m s·ª± ki·ªán l∆∞u m·ªói khi nh·∫≠p
                    input.addEventListener('input', saveData);
                    return input;
                };

                inputWrapper.appendChild(createInput('nhan', '-'));
                inputWrapper.appendChild(createInput('tra', '-'));
                
                itemRow.appendChild(itemName);
                itemRow.appendChild(inputWrapper);
                itemList.appendChild(itemRow);
            });

            // 2. M·ªöI: H√†m L∆∞u & T·∫£i d·ªØ li·ªáu t·ª´ LocalStorage
            function saveData() {
                const data = {};
                document.querySelectorAll('.quantity-input').forEach(input => {
                    if (input.value) {
                        data[input.id] = input.value;
                    }
                });
                localStorage.setItem('burgerApp_data', JSON.stringify(data));
            }

            function loadData() {
                const savedData = localStorage.getItem('burgerApp_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    for (const [id, value] of Object.entries(data)) {
                        const input = document.getElementById(id);
                        if (input) input.value = value;
                    }
                    // T·ª± ƒë·ªông t√≠nh to√°n l·∫°i n·∫øu c√≥ d·ªØ li·ªáu c≈©
                    calculateAndDisplaySummary();
                }
            }

            // 3. M·ªöI: H√†m Reset (L√†m m·ªõi)
            resetBtn.addEventListener('click', () => {
                if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h·∫øt d·ªØ li·ªáu nh·∫≠p kh√¥ng?')) {
                    document.querySelectorAll('.quantity-input').forEach(input => input.value = '');
                    localStorage.removeItem('burgerApp_data');
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center text-sm">D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi.</li>';
                }
            });

            // 4. Logic T√≠nh to√°n (Gi·ªØ nguy√™n logic c≈©)
            function calculateAndDisplaySummary() {
                summaryList.innerHTML = ''; 
                const quantities = {};
                let hasInput = false;
                
                items.forEach(item => {
                    const id = item.replace(/\s+/g, '-');
                    const valNhan = parseInt(document.getElementById(`item-nhan-${id}`).value, 10) || 0;
                    const valTra = parseInt(document.getElementById(`item-tra-${id}`).value, 10) || 0;
                    
                    if (valNhan > 0 || valTra > 0) hasInput = true;

                    const netQuantity = valNhan - valTra;
                    quantities[item] = Math.max(0, netQuantity);
                });

                if (!hasInput) {
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center text-sm">Ch∆∞a c√≥ d·ªØ li·ªáu nh·∫≠p.</li>';
                    return;
                }

                const comboResults = {};
                let hasItems = false;

                recipes.forEach(recipe => {
                    let maxCombos = Infinity;
                    for (const ingredient in recipe.ingredients) {
                        const required = recipe.ingredients[ingredient];
                        const available = quantities[ingredient] || 0;
                        maxCombos = Math.min(maxCombos, Math.floor(available / required));
                    }

                    if (maxCombos === Infinity) maxCombos = 0;

                    if (maxCombos > 0) {
                        hasItems = true;
                        if (comboResults[recipe.name]) {
                             comboResults[recipe.name].amount += maxCombos;
                        } else {
                             comboResults[recipe.name] = { amount: maxCombos, ...recipe };
                        }
                        for (const ingredient in recipe.ingredients) {
                            quantities[ingredient] -= maxCombos * recipe.ingredients[ingredient];
                        }
                    }
                });

                for (const comboName in comboResults) {
                    appendSummaryItem(comboName, comboResults[comboName].amount, comboResults[comboName].color, comboResults[comboName].bgColor);
                }

                for (const item in quantities) {
                    if (quantities[item] > 0) {
                        hasItems = true;
                        let isRecipeIngredient = recipes.some(recipe => recipe.ingredients[item]);
                        const label = isRecipeIngredient ? `${item} (d∆∞)` : item;
                        appendSummaryItem(label, quantities[item], 'text-gray-800', 'bg-gray-100');
                    }
                }
                
                if (!hasItems) {
                    summaryList.innerHTML = '<li class="text-gray-500 italic text-center">Kh√¥ng b√°n ƒë∆∞·ª£c combo n√†o.</li>';
                }
            }

            function appendSummaryItem(name, quantity, textColor, bgColor) {
                const li = document.createElement('li');
                li.className = `py-3 px-4 rounded-lg flex justify-between items-center ${bgColor}`;
                li.innerHTML = `
                    <span class="font-bold ${textColor}">${name}</span>
                    <span class="font-bold text-xl ${textColor}">${quantity}</span>
                `;
                summaryList.appendChild(li);
            }

            calculateBtn.addEventListener('click', calculateAndDisplaySummary);

            // Load d·ªØ li·ªáu khi m·ªü app
            loadData();
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('SW registered!', reg.scope));
            });
        }
    </script>
</body>
</html>


